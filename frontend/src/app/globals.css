@tailwind base;
@tailwind components;
@tailwind utilities;

/* ============================================
   设计系统 - 全局样式
   ============================================ */

@layer base {
  /* ============================================
     Light Theme - 清新明亮
     ============================================ */
  :root {
    /* 背景色 */
    --background: 252 252 253;
    --background-secondary: 248 249 251;
    --background-tertiary: 243 244 246;

    /* 表面色 */
    --surface: 255 255 255;
    --surface-hover: 248 250 252;
    --surface-border: 229 231 235;
    --surface-elevated: 255 255 255;

    /* 文本色 - 优化对比度 */
    --content-primary: 15 23 42;
    --content-secondary: 51 65 85;
    --content-tertiary: 100 116 139;
    --content-muted: 148 163 184;

    /* 强调色 */
    --accent-primary: 99 102 241;
    --accent-primary-hover: 79 70 229;
    --accent-secondary: 139 92 246;
  }

  /* ============================================
     Dark Theme - 深邃优雅
     ============================================ */
  .dark {
    /* 背景色 - 深蓝灰色调 */
    --background: 10 13 20;
    --background-secondary: 15 20 30;
    --background-tertiary: 22 28 40;

    /* 表面色 */
    --surface: 22 28 40;
    --surface-hover: 32 40 55;
    --surface-border: 45 55 72;
    --surface-elevated: 28 35 50;

    /* 文本色 - 柔和护眼 */
    --content-primary: 241 245 249;
    --content-secondary: 203 213 225;
    --content-tertiary: 148 163 184;
    --content-muted: 100 116 139;

    /* 强调色 - 暗色模式下稍微提亮 */
    --accent-primary: 129 140 248;
    --accent-primary-hover: 99 102 241;
    --accent-secondary: 167 139 250;
  }

  /* ============================================
     全局重置与基础样式
     ============================================ */
  * {
    @apply border-surface-border;
  }

  html {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
  }

  body {
    @apply bg-background text-content-primary font-sans;
    min-height: 100vh;
  }

  /* Light theme 背景 */
  :root body {
    background-image:
      radial-gradient(ellipse 80% 50% at 50% -20%, rgb(99 102 241 / 0.04), transparent),
      linear-gradient(to bottom, rgb(252 252 253), rgb(248 249 251));
    background-attachment: fixed;
  }

  /* Dark theme 背景 */
  .dark body {
    background-image:
      radial-gradient(ellipse 80% 50% at 50% -20%, rgb(99 102 241 / 0.08), transparent),
      radial-gradient(ellipse 60% 40% at 80% 80%, rgb(139 92 246 / 0.04), transparent),
      linear-gradient(to bottom, rgb(10 13 20), rgb(15 20 30));
    background-attachment: fixed;
  }

  /* ============================================
     滚动条样式
     ============================================ */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    @apply bg-transparent;
  }

  ::-webkit-scrollbar-thumb {
    @apply bg-surface-border/50 rounded-full;
    transition: background-color 0.2s;
  }

  ::-webkit-scrollbar-thumb:hover {
    @apply bg-content-muted/40;
  }

  /* ============================================
     文本选择
     ============================================ */
  ::selection {
    @apply bg-accent-primary/20 text-content-primary;
  }

  /* ============================================
     标题样式
     ============================================ */
  h1, h2, h3, h4, h5, h6 {
    @apply font-display font-semibold tracking-tight text-content-primary;
  }

  /* ============================================
     数字等宽
     ============================================ */
  .tabular-nums {
    font-variant-numeric: tabular-nums;
  }
}

@layer components {
  /* ============================================
     卡片系统
     ============================================ */
  .card {
    @apply bg-surface/80 backdrop-blur-sm border border-surface-border rounded-xl p-5;
    @apply shadow-card dark:shadow-card-dark;
    @apply transition-all duration-200 ease-out;
  }

  .card-hover {
    @apply hover:shadow-card-hover dark:hover:shadow-card-dark-hover;
    @apply hover:border-accent-primary/20 hover:bg-surface/95;
    @apply hover:-translate-y-0.5;
  }

  .card-interactive {
    @apply card card-hover cursor-pointer;
  }

  /* ============================================
     玻璃效果
     ============================================ */
  .glass {
    @apply bg-surface/50 backdrop-blur-xl border border-white/10;
  }

  .glass-subtle {
    @apply bg-surface/30 backdrop-blur-md border border-surface-border/50;
  }

  /* ============================================
     渐变文本
     ============================================ */
  .text-gradient {
    @apply bg-gradient-to-r from-brand-500 via-brand-400 to-accent-secondary bg-clip-text text-transparent;
  }

  .text-gradient-brand {
    @apply bg-gradient-brand bg-clip-text text-transparent;
  }

  /* ============================================
     发光效果
     ============================================ */
  .glow-brand {
    @apply shadow-glow-brand;
  }

  .glow-success {
    @apply shadow-glow-success;
  }

  /* ============================================
     网格背景
     ============================================ */
  .bg-grid {
    background-size: 40px 40px;
    background-image:
      linear-gradient(to right, rgb(99 102 241 / 0.03) 1px, transparent 1px),
      linear-gradient(to bottom, rgb(99 102 241 / 0.03) 1px, transparent 1px);
  }

  .dark .bg-grid {
    background-image:
      linear-gradient(to right, rgb(99 102 241 / 0.05) 1px, transparent 1px),
      linear-gradient(to bottom, rgb(99 102 241 / 0.05) 1px, transparent 1px);
  }

  /* ============================================
     斜线网格背景
     ============================================ */
  .bg-diagonal-grid {
    position: relative;
    overflow: hidden;
  }

  .bg-diagonal-grid::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      repeating-linear-gradient(
        -45deg,
        transparent,
        transparent 40px,
        rgb(99 102 241 / 0.02) 40px,
        rgb(99 102 241 / 0.02) 41px
      ),
      repeating-linear-gradient(
        45deg,
        transparent,
        transparent 40px,
        rgb(139 92 246 / 0.015) 40px,
        rgb(139 92 246 / 0.015) 41px
      );
    pointer-events: none;
    z-index: 0;
  }

  .dark .bg-diagonal-grid::before {
    background-image:
      repeating-linear-gradient(
        -45deg,
        transparent,
        transparent 40px,
        rgb(99 102 241 / 0.04) 40px,
        rgb(99 102 241 / 0.04) 41px
      ),
      repeating-linear-gradient(
        45deg,
        transparent,
        transparent 40px,
        rgb(139 92 246 / 0.03) 40px,
        rgb(139 92 246 / 0.03) 41px
      );
  }

  .bg-diagonal-grid > * {
    position: relative;
    z-index: 1;
  }

  /* ============================================
     助手页面光晕
     ============================================ */
  .bg-assistant-glow {
    position: relative;
    overflow: hidden;
  }

  .bg-assistant-glow::after {
    content: '';
    position: absolute;
    top: -20%;
    right: -10%;
    width: 50%;
    height: 50%;
    background: radial-gradient(
      ellipse at center,
      rgb(99 102 241 / 0.08) 0%,
      rgb(139 92 246 / 0.04) 40%,
      transparent 70%
    );
    pointer-events: none;
    z-index: 0;
  }

  .dark .bg-assistant-glow::after {
    background: radial-gradient(
      ellipse at center,
      rgb(99 102 241 / 0.12) 0%,
      rgb(139 92 246 / 0.06) 40%,
      transparent 70%
    );
  }

  .bg-assistant-glow > * {
    position: relative;
    z-index: 1;
  }

  /* ============================================
     进度条
     ============================================ */
  .score-bar {
    @apply h-1.5 rounded-full overflow-hidden bg-background-tertiary;
  }

  .score-bar-fill {
    @apply h-full rounded-full transition-all duration-700 ease-out;
    animation: fillBar 0.8s ease-out forwards;
  }

  @keyframes fillBar {
    from { width: 0; }
  }

  /* ============================================
     数据网格
     ============================================ */
  .data-grid {
    @apply grid gap-4;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  }

  /* ============================================
     标签
     ============================================ */
  .tag {
    @apply inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-xs font-medium;
    @apply bg-surface border border-surface-border/50;
    @apply transition-colors duration-150;
  }

  .tag-brand {
    @apply bg-brand-50 text-brand-600 border-brand-200;
    @apply dark:bg-brand-950/50 dark:text-brand-400 dark:border-brand-800/50;
  }

  .tag-success {
    @apply bg-accent-success-light text-accent-success border-accent-success/20;
    @apply dark:bg-accent-success/10 dark:text-accent-success dark:border-accent-success/20;
  }

  .tag-warning {
    @apply bg-accent-warning-light text-accent-warning border-accent-warning/20;
    @apply dark:bg-accent-warning/10 dark:text-accent-warning dark:border-accent-warning/20;
  }

  .tag-error {
    @apply bg-accent-error-light text-accent-error border-accent-error/20;
    @apply dark:bg-accent-error/10 dark:text-accent-error dark:border-accent-error/20;
  }

  /* ============================================
     骨架屏
     ============================================ */
  .skeleton {
    @apply animate-pulse bg-surface-border/40 rounded;
  }

  /* ============================================
     排版类
     ============================================ */
  .text-display {
    @apply text-4xl md:text-5xl font-display font-bold tracking-tight text-content-primary;
  }

  .text-heading-lg {
    @apply text-2xl md:text-3xl font-display font-semibold tracking-tight text-content-primary;
  }

  .text-heading {
    @apply text-xl font-display font-semibold tracking-tight text-content-primary;
  }

  .text-heading-sm {
    @apply text-lg font-medium text-content-primary;
  }

  .text-body {
    @apply text-base text-content-secondary leading-relaxed;
  }

  .text-body-sm {
    @apply text-sm text-content-secondary leading-relaxed;
  }

  .text-caption {
    @apply text-xs text-content-tertiary;
  }

  .text-label {
    @apply text-xs font-semibold uppercase tracking-wider text-content-muted;
  }

  /* ============================================
     页面标题
     ============================================ */
  .page-title {
    @apply text-2xl md:text-3xl font-display font-bold tracking-tight text-content-primary;
  }

  .page-subtitle {
    @apply text-sm text-content-tertiary mt-1;
  }

  /* ============================================
     统计数字
     ============================================ */
  .stat-number {
    @apply text-3xl md:text-4xl font-display font-bold tracking-tight tabular-nums;
  }

  /* ============================================
     导航链接
     ============================================ */
  .nav-link {
    @apply flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium text-content-secondary;
    @apply hover:bg-surface hover:text-content-primary;
    @apply transition-all duration-150;
  }

  .nav-link-active {
    @apply bg-brand-50 text-brand-600 dark:bg-brand-950/50 dark:text-brand-400;
  }

  /* ============================================
     数据表格
     ============================================ */
  .data-table {
    @apply w-full text-sm;
  }

  .data-table th {
    @apply text-left text-xs font-semibold uppercase tracking-wider text-content-muted;
    @apply py-3 px-4 border-b border-surface-border;
  }

  .data-table td {
    @apply py-3.5 px-4 text-content-secondary border-b border-surface-border/50;
  }

  .data-table tr {
    @apply transition-colors duration-150;
  }

  .data-table tr:hover td {
    @apply bg-surface/50;
  }

  /* ============================================
     按钮系统
     ============================================ */
  .btn {
    @apply inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium;
    @apply transition-all duration-150 ease-out;
    @apply disabled:opacity-50 disabled:cursor-not-allowed disabled:pointer-events-none;
    @apply focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background;
  }

  .btn-primary {
    @apply bg-brand-500 text-white;
    @apply hover:bg-brand-600 hover:shadow-md hover:-translate-y-0.5;
    @apply focus:ring-brand-500/50;
    @apply active:translate-y-0;
  }

  .btn-secondary {
    @apply bg-surface text-content-secondary border border-surface-border;
    @apply hover:bg-surface-hover hover:text-content-primary hover:border-surface-border;
    @apply focus:ring-surface-border;
  }

  .btn-ghost {
    @apply bg-transparent text-content-secondary;
    @apply hover:bg-surface hover:text-content-primary;
    @apply focus:ring-surface-border;
  }

  .btn-danger {
    @apply bg-accent-error text-white;
    @apply hover:bg-accent-error/90 hover:shadow-md;
    @apply focus:ring-accent-error/50;
  }

  .btn-sm {
    @apply px-3 py-1.5 text-xs rounded-lg;
  }

  .btn-lg {
    @apply px-6 py-3 text-base rounded-xl;
  }

  .btn-icon {
    @apply p-2.5 rounded-xl;
  }

  /* ============================================
     输入框
     ============================================ */
  .input {
    @apply w-full px-4 py-2.5 bg-background-secondary border border-surface-border rounded-xl;
    @apply text-sm text-content-primary placeholder:text-content-muted;
    @apply focus:outline-none focus:border-brand-500/50 focus:ring-2 focus:ring-brand-500/20;
    @apply transition-all duration-150;
  }

  .input-error {
    @apply border-accent-error/50 focus:border-accent-error focus:ring-accent-error/20;
  }

  /* ============================================
     选择框
     ============================================ */
  .select {
    @apply input appearance-none cursor-pointer pr-10;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2394a3b8' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 0.75rem center;
    background-repeat: no-repeat;
    background-size: 1.25rem;
  }

  /* ============================================
     聊天样式
     ============================================ */
  .chat-message-user {
    @apply bg-brand-500 text-white rounded-2xl rounded-tr-md;
  }

  .chat-message-assistant {
    @apply bg-surface border border-surface-border rounded-2xl rounded-tl-md;
  }

  /* ============================================
     Markdown 样式
     ============================================ */
  .prose-chat {
    @apply text-sm leading-relaxed text-content-secondary;
  }

  .prose-chat h2,
  .prose-chat h3,
  .prose-chat h4 {
    @apply font-semibold text-content-primary mt-4 mb-2;
  }

  .prose-chat h2 { @apply text-base; }
  .prose-chat h3 { @apply text-sm; }
  .prose-chat h4 { @apply text-sm; }

  .prose-chat p {
    @apply my-2;
  }

  .prose-chat ul,
  .prose-chat ol {
    @apply my-2 space-y-1;
  }

  .prose-chat li {
    @apply ml-4;
  }

  .prose-chat code {
    @apply bg-background-tertiary/50 px-1.5 py-0.5 rounded text-xs font-mono;
  }

  .prose-chat pre {
    @apply bg-background-tertiary/50 rounded-lg p-3 overflow-x-auto my-2;
  }

  .prose-chat pre code {
    @apply bg-transparent p-0;
  }

  .prose-chat blockquote {
    @apply border-l-2 border-brand-500/40 pl-3 my-2 text-content-tertiary italic;
  }

  .prose-chat table {
    @apply w-full my-2;
  }

  .prose-chat th,
  .prose-chat td {
    @apply border border-surface-border/50 px-2 py-1 text-xs;
  }

  .prose-chat strong {
    @apply font-semibold text-content-primary;
  }

  /* ============================================
     Streamdown 样式
     ============================================ */
  [data-streamdown] {
    @apply font-sans;
    font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
  }

  [data-streamdown="heading-1"] {
    @apply text-xl font-display font-bold tracking-tight text-content-primary mt-6 mb-3;
  }

  [data-streamdown="heading-2"] {
    @apply text-lg font-display font-bold tracking-tight text-content-primary mt-5 mb-2.5;
  }

  [data-streamdown="heading-3"] {
    @apply text-base font-display font-semibold tracking-snug text-content-primary mt-4 mb-2;
  }

  [data-streamdown="heading-4"],
  [data-streamdown="heading-5"],
  [data-streamdown="heading-6"] {
    @apply text-[0.9375rem] font-display font-semibold tracking-snug text-content-primary mt-3 mb-1.5;
  }

  [data-streamdown="paragraph"] {
    @apply text-[0.9375rem] leading-[1.65] text-content-secondary my-2.5;
  }

  [data-streamdown="strong"] {
    @apply font-bold text-content-primary;
  }

  [data-streamdown="emphasis"] {
    @apply italic text-content-secondary;
  }

  [data-streamdown="link"] {
    @apply text-brand-500 hover:text-brand-600 underline underline-offset-2 transition-colors;
  }

  [data-streamdown="ordered-list"],
  [data-streamdown="unordered-list"] {
    @apply my-2.5 ml-5 text-[0.9375rem] leading-[1.65] text-content-secondary;
  }

  [data-streamdown="ordered-list"] {
    @apply list-decimal;
  }

  [data-streamdown="unordered-list"] {
    @apply list-disc;
  }

  [data-streamdown="list-item"] {
    @apply my-1.5;
  }

  [data-streamdown="inline-code"] {
    @apply font-mono text-[0.875rem] bg-surface/60 text-brand-500 px-1.5 py-0.5 rounded;
  }

  [data-streamdown="code-block"] {
    @apply font-mono text-[0.875rem] bg-surface/50 rounded-xl border border-surface-border/40 overflow-hidden my-3;
  }

  [data-streamdown="code-block"] pre {
    @apply p-4 overflow-x-auto;
  }

  [data-streamdown="code-block"] code {
    @apply text-[0.875rem] leading-relaxed;
  }

  [data-streamdown="table-wrapper"] {
    @apply overflow-x-auto my-3 rounded-xl border border-surface-border/50;
  }

  [data-streamdown="table"] {
    @apply w-full text-[0.9375rem] border-collapse;
  }

  [data-streamdown="table-header"] {
    @apply bg-surface/50;
  }

  [data-streamdown="table-body"] {
    @apply divide-y divide-surface-border/30;
  }

  [data-streamdown="table-row"] {
    @apply hover:bg-surface/30 transition-colors;
  }

  [data-streamdown="table-header-cell"] {
    @apply px-3 py-2.5 text-left text-sm font-semibold text-content-primary border-b border-surface-border/50;
  }

  [data-streamdown="table-cell"] {
    @apply px-3 py-2.5 text-[0.9375rem] text-content-secondary;
  }

  [data-streamdown="blockquote"] {
    @apply border-l-2 border-brand-500/40 pl-4 my-3 text-content-tertiary italic text-[0.9375rem] leading-[1.65];
  }

  [data-streamdown="horizontal-rule"] {
    @apply my-4 border-surface-border/50;
  }

  /* ============================================
     打字光标
     ============================================ */
  .typing-cursor::after {
    content: '|';
    @apply animate-pulse text-brand-500;
  }

  /* ============================================
     聊天内容块
     ============================================ */
  [data-chat-block] {
    @apply relative;
  }

  [data-chat-block="thinking"] {
    @apply my-3 rounded-xl border border-violet-500/20 bg-violet-500/5 overflow-hidden;
  }

  [data-chat-block="thinking"] .thinking-header {
    @apply flex items-center gap-2 px-3 py-2.5 cursor-pointer select-none;
    @apply text-xs font-medium text-violet-600 dark:text-violet-400;
    @apply hover:bg-violet-500/10 transition-colors;
  }

  [data-chat-block="thinking"] .thinking-icon {
    @apply w-4 h-4 text-violet-500 dark:text-violet-400;
  }

  [data-chat-block="thinking"] .thinking-content {
    @apply px-3 pb-3 text-sm text-content-tertiary leading-relaxed;
    @apply border-t border-violet-500/10 pt-2;
  }

  [data-chat-block="thinking"] .thinking-badge {
    @apply ml-auto px-1.5 py-0.5 rounded text-[10px] font-medium;
    @apply bg-violet-500/10 text-violet-600 dark:text-violet-400;
  }

  [data-chat-block="text"] {
    @apply text-content-secondary text-[0.9375rem] leading-[1.65];
  }

  [data-chat-block="separator"] {
    @apply my-4 flex items-center gap-3;
  }

  [data-chat-block="separator"]::before,
  [data-chat-block="separator"]::after {
    content: '';
    @apply flex-1 h-px bg-gradient-to-r from-transparent via-surface-border/50 to-transparent;
  }

  [data-chat-block="separator"] .separator-label {
    @apply text-[10px] font-medium uppercase tracking-wider text-content-muted/60;
  }

  [data-chat-block="redacted"] {
    @apply my-3 px-3 py-2.5 rounded-lg;
    @apply bg-amber-500/5 border border-amber-500/20;
    @apply text-xs text-amber-600 dark:text-amber-400;
    @apply flex items-center gap-2;
  }

  [data-chat-block="redacted"] .redacted-icon {
    @apply w-4 h-4 opacity-70;
  }

  [data-chat-block].streaming {
    @apply animate-pulse;
  }

  .dark [data-chat-block="thinking"] {
    @apply border-violet-400/20 bg-violet-400/5;
  }
}

@layer utilities {
  /* ============================================
     渐变边框
     ============================================ */
  .border-gradient {
    border: 1px solid transparent;
    background:
      linear-gradient(var(--tw-gradient-stops)) padding-box,
      linear-gradient(135deg, rgb(99 102 241 / 0.5), rgb(139 92 246 / 0.5)) border-box;
  }

  /* ============================================
     文本描边
     ============================================ */
  .text-stroke {
    -webkit-text-stroke: 1px currentColor;
    -webkit-text-fill-color: transparent;
  }

  /* ============================================
     隐藏滚动条
     ============================================ */
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* ============================================
     文本平衡
     ============================================ */
  .text-balance {
    text-wrap: balance;
  }

  /* ============================================
     焦点环
     ============================================ */
  .focus-ring {
    @apply focus:outline-none focus:ring-2 focus:ring-brand-500/30 focus:ring-offset-2 focus:ring-offset-background;
  }

  /* ============================================
     渐变遮罩
     ============================================ */
  .mask-gradient-b {
    mask-image: linear-gradient(to bottom, black 60%, transparent);
  }

  .mask-gradient-t {
    mask-image: linear-gradient(to top, black 60%, transparent);
  }
}
